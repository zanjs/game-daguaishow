function s(t){return document.getElementById(t)}function sClass(t){return document.querySelector(t)}function bind(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,function(){i.call(t)})}function view(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}function addClass(t,e){var i=t.className.split(" ");if(!t.className)return void(t.className=e);for(var n=0;n<i.length;n++)if(i[n]===e)return;t.className+=" "+e}function removeClass(t,e){var i=t.className.split(" ");if(t.className)for(var n=0;n<i.length;n++)if(i[n]===e){i.splice(n,1),t.className=i.join(" ");break}}function hasClass(t,e){var i=t.className.split(" ");if(!t.className)return!1;for(var n=0;n<i.length;n++)if(i[n]===e)return!0;return!1}function getByClass(t,e,i){for(var n=t.getElementsByTagName(e),s=[],r=new RegExp("(^|\\s)"+i+"(\\s|$)"),o=0;o<n.length;o++)r.test(n[o].className)&&s.push(n[o]);return s}function lexIndex(t){for(var e=lexChildren(t.parentNode),i=0;i<e.length;i++)if(t==e[i])return i}function lexPrevAll(t,e){for(var i=lexChildren(t.parentNode),n=0;n<i.length;n++)t==i[n]&&(e?i.splice(n+1):i.splice(n));return i}function lexNextAll(t,e){for(var i=lexChildren(t.parentNode),n=0;n<i.length;n++)t==i[n]&&(e?i.splice(0,n):i.splice(0,n+1));return i}function lexSibling(t){for(var e=lexChildren(t.parentNode),i=0;i<e.length;i++)t==e[i]&&e.splice(i,1);return e}function lexChildren(t){for(var e=t.childNodes,i=[],n=0;n<e.length;n++)"#text"!=e[n].nodeName||/\s/.test(e.nodeValue)?i.push(e[n]):t.removeChild(e[n]);return i}function remove(t){t.parentNode.removeChild(t)}function getByParent(t,e,i){for(var n=new RegExp("(^|\\s)"+i+"(\\s|$)");t.parentNode;)if(t.parentNode.tagName!=e)t=t.parentNode;else{if(n.test(t.parentNode.className))return t.parentNode;t=t.parentNode}}function getNums(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(getNum({num:arguments[e].num,min:arguments[e].min,max:arguments[e].max}));return t.sort(randomsort)}function randomsort(t,e){return Math.random()>.5?-1:1}function getNum(t){for(var e=t.min||0,i=t.num,n=t.max,s=t.sort,r=[],o={};r.length<i;){var a=Math.round(Math.random()*n);!o[a]&&a>e&&(r.push(a),o[a]=1)}return">"==s?(r.sort(function(t,e){return e-t}),r):"<"==s?(r.sort(function(t,e){return t-e}),r):r}function stopPP(t){bind(t,"touchstart",function(t){var t=t||event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0})}function startMove(t,e,i,n,s){function r(t,e){return t.currentStyle?t.currentStyle[e]:getComputedStyle(t,!1)[e]}function o(){return(new Date).getTime()}"undefined"==typeof i&&(i=400,n="linear"),"string"==typeof i?("function"==typeof n&&(s=n),n=i,i=400):"function"==typeof i?(s=i,i=400,n="linear"):"number"==typeof i&&("function"==typeof n?(s=n,n="linear"):"undefined"==typeof n&&(n="linear"));var a={};for(var h in e)a[h]=0,"opacity"==h?a[h]=Math.round(100*r(t,h)):a[h]=parseInt(r(t,h));var l=o();clearInterval(t.timer),t.timer=setInterval(function(){var r=o(),h=i-Math.max(0,l-r+i);for(var c in e){var u=Tween[n](h,a[c],e[c]-a[c],i);"opacity"==c?(t.style.opacity=u/100,t.style.filter="alpha(opacity="+u+")"):t.style[c]=u+"px"}h==i&&(clearInterval(t.timer),s&&s.call(t))},13)}function game(t){function e(){for(var t=0;r>t;t++)n.monNum.push(r);r++,30>r&&e()}function i(t){var e=this;e.obj=t.obj,e.jdC=200,e.jd=t.jd||-2,e.r=t.r||200,e.clockwise=t.clockwise?!1:!0,e.variable=2*(n.w+n.h)/(n.roundT/n.speed),e.timeC=!0;var i=getNum({num:1,min:0,max:3});switch(i[0]){case 0:e.firstPositionX=getNum({num:1,min:n.minW,max:n.maxW})[0],e.firstPositionY=n.minH,e.jdC=100;break;case 1:e.firstPositionY=getNum({num:1,min:n.minH,max:n.maxH})[0],e.firstPositionX=n.minW,e.jdC=-330;break;case 2:e.firstPositionX=getNum({num:1,min:n.minW,max:n.maxW})[0],e.firstPositionY=n.maxH,e.jdC=-100;break;case 3:e.firstPositionY=getNum({num:1,min:n.minH,max:n.maxH})[0],e.firstPositionX=n.maxW,e.jdC=200}}s("page").width=view().w,s("page").height=view().h;var n=this;n.mon={mon1:function(t){jc.start(t.canvas,!0);var e=new Image;e.src="dist/images/monster1.png",e.onload=function(){jc.start(t.canvas),jc.image(e,-200,-200,109,114).id(t.id).level(2)}},mon2:function(t){jc.start(t.canvas,!0);var e=new Image;e.src="dist/images/monster2.png",e.onload=function(){jc.start(t.canvas),jc.image(e,-200,-200,109,113).id(t.id).level(2)}},mon3:function(t){jc.start(t.canvas,!0);var e=new Image;e.src="dist/images/monster3.png",e.onload=function(){jc.start(t.canvas),jc.image(e,-200,-200,107,129).id(t.id).level(2)}},mon4:function(t){jc.start(t.canvas,!0);var e=new Image;e.src="dist/images/monster4.png",e.onload=function(){jc.start(t.canvas),jc.image(e,-200,-200,125,110).id(t.id).level(2)}},m1:[180,138],m2:[146,84],m3:[103,94],m4:[92,107]},n.time=[10],n.monNum=[];var r=1;e(),n.score=0,n.w=view().w-50,n.h=view().h-50,n.monomer={},n.position={},n.num=0,n.minW=50,n.minH=50,n.maxW=n.w-120,n.maxH=n.h-150,n.speed=18,n.roundT=2e4,i.prototype.run=function(){var t=this;t.clockwise?t.firstPositionX>n.minW&&t.firstPositionY==n.minH?(t.firstPositionX=t.firstPositionX-t.variable,t.firstPositionX<n.minW&&(t.firstPositionX=n.minW)):t.firstPositionX>=n.minW&&t.firstPositionY==n.maxH&&t.firstPositionX<n.maxW?(t.firstPositionX=t.firstPositionX+t.variable,t.firstPositionX>n.maxW&&(t.firstPositionX=n.maxW)):t.firstPositionX==n.minW&&t.firstPositionY>=n.minH&&t.firstPositionY<n.maxH?(t.firstPositionY=t.firstPositionY+t.variable,t.firstPositionY>n.maxH&&(t.firstPositionY=n.maxH)):t.firstPositionX==n.maxW&&t.firstPositionY>n.minH&&(t.firstPositionY=t.firstPositionY-t.variable,t.firstPositionY<n.minH&&(t.firstPositionY=n.minH)):t.firstPositionX<n.maxW&&t.firstPositionY==n.minH?(t.firstPositionX=t.firstPositionX+t.variable,t.firstPositionX>n.maxW&&(t.firstPositionX=n.maxW)):t.firstPositionX>n.minW&&t.firstPositionY==n.maxH&&t.firstPositionX<=n.maxW?(t.firstPositionX=t.firstPositionX-t.variable,t.firstPositionX<n.minW&&(t.firstPositionX=n.minW)):t.firstPositionX==n.minW&&t.firstPositionY>n.minH&&t.firstPositionY<=n.maxH?(t.firstPositionY=t.firstPositionY-t.variable,t.firstPositionY<n.minH&&(t.firstPositionY=n.minH)):t.firstPositionX==n.maxW&&t.firstPositionY<n.maxH&&(t.firstPositionY=t.firstPositionY+t.variable,t.firstPositionY>n.maxH&&(t.firstPositionY=n.maxH)),t.jdC=t.jdC-t.jd,t.x=t.firstPositionX-t.r*Math.cos(t.jdC*Math.PI/180),t.y=t.firstPositionY-t.r*Math.sin(t.jdC*Math.PI/180),n.position[t.obj]=[],n.position[t.obj][0]=t.x,n.position[t.obj][1]=t.y,jc("#"+t.obj).animate({x:t.x,y:t.y},1)},i.prototype.Stop=function(t){t.next&&(n.num++,s("score").innerHTML="X"+Number(n.num));var e=this;e.timeC=!1;var i=jc("#"+e.obj)._img.src.split("/"),r=i[i.length-1];jc.start("page",!0);var o=new Image;o.src="dist/images/monster1"+r.findNum()[0]+".png",o.onload=function(){jc.start("page"),jc.image(o,n.position[t.a][0],n.position[t.a][1],n.mon["m"+r.findNum()[0]][0],n.mon["m"+r.findNum()[0]][1]).id(e.obj+"d").level(1);var i=1;e.die={},e.die[e.obj+"d"]=setInterval(function(){i++,jc("#"+e.obj+"d").opacity(1-i/40),jc("#"+e.obj+"d").scale(1+i/8e3,1+i/8e3),0>1-i/40&&(jc("#"+e.obj+"d").del(),clearInterval(e.die[e.obj+"d"]))},60),jc("#"+e.obj).del(),n.monomer[t.a]=void 0,n.position[t.a][0]=0,n.position[t.a][1]=0;for(b in n.monomer)if(n.monomer[b])return!1;clearTimeout(n.timeC),clearInterval(n.countdown),t.next&&setTimeout(function(){n.score++,jc.clear(),n.next()},2e3)}},n.next=function(){function t(){var e=200,s=Math.round(Math.random());if(s)var o=3;else var o=-3;setTimeout(function(){n.mon["mon"+getNum({min:0,max:4,num:1})[0]]({canvas:"page",id:"span"+r+n.score}),n.monomer["span"+r+n.score]=new i({obj:"span"+r+n.score,jd:o,r:e,clockwise:s}),r++,r<n.monNum[n.score]&&t()},200)}n.position={},n.monomer={},clearTimeout(n.timeC),clearInterval(n.countdown),clearInterval(n.run),n.runing(),n.timeC=setTimeout(function(){n.num<=0?(gameOver(),alertWin({text:"纳尼！你居然一个鬼子都按不死！你不爱国吗，给你一个机会，再来一次！",notshare:!0})):(timeOver(),alertWin({text:"恭喜你消灭了"+n.num+"只鬼子！"}));for(a in n.monomer)try{n.monomer[a].Stop({a:a})}catch(t){console.log(t.name,t.message)}clearInterval(n.countdown),document.ontouchstart=null},1e3*(n.time[0]+1)),s("time").innerHTML=n.time[0]+"秒";var e=1;n.countdown=setInterval(function(){s("time").innerHTML=n.time[0]-e+"秒",e++},1e3);var r=0;t()}}function alertWin(t){if(t.text){var e=document.createElement("div");e.className="scrollBg",e.id="scrollBg",t.notshare?e.innerHTML='<div class="alert"><span>'+t.text+"</span><button>再来一次</button></div>":e.innerHTML='<div class="alert"><span>'+t.text+'</span><a href="javascript:;">分享</a><button>再来一次</button></div>',document.body.appendChild(e),e.getElementsByTagName("button")[0].ontouchstart=function(t){var t=t||event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,remove(e),gamePage["int"](),gamePage.bindEvent(),s("prompt")&&remove(s("prompt")),readyGo()},e.getElementsByTagName("a")[0]&&(e.getElementsByTagName("a")[0].ontouchstart=function(t){var t=t||event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,showPrompt()})}}function showPrompt(t){s("scrollBg").style.opacity=0;var e=document.createElement("div");e.className="prompt",e.innerHTML="",e.id="prompt",document.body.appendChild(e),e.ontouchend=function(){s("scrollBg").style.opacity=1,remove(e)}}function musicShow(){var t=s("music").getElementsByTagName("audio")[0];t.autoPlay,t.play(),stopPP(s("music")),bind(s("music"),"touchstart",function(){t.paused?(t.play(),addClass(s("music"),"music"),removeClass(s("music"),"musicStop")):(t.pause(),removeClass(s("music"),"music"),addClass(s("music"),"musicStop"))})}function lolStart(){var t=s("lolStart").getElementsByTagName("audio")[0];t.autoplay,t.play(),setTimeout(musicShow(),1e3)}function lolCareful(){var t=s("lolCareful").getElementsByTagName("audio")[0];t.autoplay,t.play&&(t.currentTime=0),t.play()}function gameHit(){var t=s("gameHit").getElementsByTagName("audio")[0];t.autoplay,t.play&&(t.currentTime=0),t.play()}function timeOver(){var t=s("timeOver").getElementsByTagName("audio")[0];t.autoplay,t.play()}function gameOver(){var t=s("gameOver").getElementsByTagName("audio")[0];t.autoplay,t.play()}function readyGo(){var t=s("readyGo").getElementsByTagName("audio")[0];t.autoplay,t.play()}function changePage(){function t(t){return 0==n&&1==t?!1:(3==n&&-1==t&&(window.location.href="game.html"),removeClass(i[n],"sectionIn"),addClass(i[n],"sectionOut"),e=!1,void setTimeout(function(){removeClass(i[n],"sectionOut"),addClass(i[n],"sectionHid"),removeClass(i[n-t],"sectionHid"),addClass(i[n-t],"sectionIn"),n-=t,e=!0},600))}var e=!0,i=document.getElementsByTagName("section"),n=(getByClass(document,"section","sectionIn")[0],0),r=0;bind(document,"touchstart",function(t){t.preventDefault();var e=t.changedTouches[0];r=e.pageY}),bind(document,"touchend",function(i){var n=i.changedTouches[0];r-n.pageY>40&&e&&loadF?t(-1):r-n.pageY<-40&&e&&loadF&&t(1)}),s("start").ontouchend=function(){window.location.href="game.html"}}!function(t,e){function i(t,e,i){var n=W[t].layers[e].objs,s=W[t].layers[e].grdntsnptrns,r=n.length,o=s.length;i=i.slice(1);for(var a=0;r>a;a++)if(n[a].optns.id==i)return n[a];for(a=0;o>a;a++)if(s[a].optns.id==i)return s[a];return!1}function n(t,e,i,n){function s(t,e,i){var n,s,r,o,a=i.length;for(r=0;a>r;r++)if(n=i[r]._name.split(" "),!(e.length>n.length)){var h=e.concat();for(s=0;s<n.length;s++){for(o=0;o<h.length;o++)n[s]!==h[o]||(h.splice(o,1),o--);if(!h.length){t.elements.push(i[r]);break}}}}var r=W[t].layers[e].objs,o=W[t].layers[e].grdntsnptrns,a=n.slice(1).split(".");return s(i,a,r),s(i,a,o),i}function s(t,e,i){for(var n=W[t].layers[e].objs,s=W[t].layers[e].grdntsnptrns,r=n.length,o=s.length,a=0;r>a;a++)i.elements.push(n[a]);for(a=0;o>a;a++)i.elements.push(s[a]);return i}function r(t){var e=t.optns;t.matrix(m(m(m(e.transformMatrix,e.translateMatrix),e.scaleMatrix),e.rotateMatrix)),a(t)}function o(t,i){for(var n in i)t[n]===e&&(t[n]=i[n]);return t}function a(t){T(t).optns.redraw=1}function h(t){for(var i=t.timeDiff,n=1,s=0;s<this.animateQueue.length;s++){var r=this.animateQueue[s],o=r.duration,h=r.easing,c=r.step,u=r.onstep,f="in"==h.type||"inOut"==h.type&&.5>n,p="out"==h.type||"inOut"==h.type&&n>.5;r.step+=i,n=c/o;for(var m in r)if(this[m]!==e&&r[m]){var d=r[m],v=d.to,y=d.from;l(m,this,r),f&&(this[m]=(v-y)*ct[h.fn](n,h)+y),p&&(this[m]=(v-y)*(1-ct[h.fn](1-n,h))+y),u&&u.fn.call(this,u),c>=o&&(this[m]=v,l(m,this,r),r[m]=!1,r.animateKeyCount--,r.animateKeyCount||(r.animateFn&&r.animateFn.apply(this),this.animateQueue.splice(s,1),s--))}}return this.animateQueue.length?a(this):this.optns.animated=!1,this}function l(t,i,n){var s=i[t],r=n[t].prev;switch(t){case"_rotateAngle":i.rotate(s-r,i._rotateX,i._rotateY);break;case"_translateX":i.translate(s-r,0);break;case"_translateY":i.translate(0,s-r);break;case"_translateToX":i.translateTo(s,e);break;case"_translateToY":i.translateTo(e,s);break;case"_scaleX":r||(r=1),i.scale(s/r,1);break;case"_scaleY":r||(r=1),i.scale(1,s/r);break;default:return}n[t].prev=s}function c(e,i,n){e=e||t.event,n[i].event=e,n[i].code=e.charCode||e.keyCode,n[i].val=!0,n.redraw=1}function u(e,i,n){if(n[i].val){e=e||t.event;var s={pageX:e.pageX||e.clientX,pageY:e.pageY||e.clientY};n[i].event=e,n[i].x=s.pageX-n.x,n[i].y=s.pageY-n.y,n.redraw=1}}function f(t,i){return t===e?this["on"+i]():this["on"+i]=t,("mouseover"==i||"mouseout"==i)&&(i="mousemove"),T(this).optns[i].val=!0,this}function p(t,i){return t===e?this[i]():this[i]=t,this}function m(t,e){return[[t[0][0]*e[0][0]+t[0][1]*e[1][0],t[0][0]*e[0][1]+t[0][1]*e[1][1],t[0][0]*e[0][2]+t[0][1]*e[1][2]+t[0][2]],[t[1][0]*e[0][0]+t[1][1]*e[1][0],t[1][0]*e[0][1]+t[1][1]*e[1][1],t[1][0]*e[0][2]+t[1][1]*e[1][2]+t[1][2]]]}function d(t,e,i){return{x:t*i[0][0]+e*i[0][1]+i[0][2],y:t*i[1][0]+e*i[1][1]+i[1][2]}}function v(t,e,i){return{x:(t*i[1][1]-e*i[0][1]+i[0][1]*i[1][2]-i[1][1]*i[0][2])/(i[0][0]*i[1][1]-i[1][0]*i[0][1]),y:(-t*i[1][0]+e*i[0][0]-i[0][0]*i[1][2]+i[1][0]*i[0][2])/(i[0][0]*i[1][1]-i[1][0]*i[0][1])}}function y(t,e,i){if("poor"==i)return e;var n={x:e.x,y:e.y},s={x:e.x+e.width,y:e.y+e.height},r=m(t.matrix(),I(t).matrix()),o=d(n.x,n.y,r),a=d(s.x,n.y,r),h=d(n.x,s.y,r),l=d(s.x,s.y,r),c=[[o.x,o.y],[a.x,a.y],[h.x,h.y],[l.x,l.y]];if("coords"==i)return c;for(var u,f,p=u=o.x,v=f=o.y,y=0;4>y;y++)p<c[y][0]&&(p=c[y][0]),v<c[y][1]&&(v=c[y][1]),u>c[y][0]&&(u=c[y][0]),f>c[y][1]&&(f=c[y][1]);return{x:u,y:f,width:p-u,height:v-f}}function g(t,e,i){return"poor"==i?e:d(e.x,e.y,m(t.matrix(),I(t).matrix()))}function _(t){var i={color:{val:t,notColor:e},r:0,g:0,b:0,a:1};if(t.id!==e)return i.color.notColor={level:t._level,canvas:t.optns.canvas.number,layer:t.optns.layer.number},i;if(t.r!==e)return i=o(t,{r:0,g:0,b:0,a:1}),i.color={val:"rgba("+i.r+","+i.g+","+i.b+","+i.a+")",notColor:e},i;if("#"==t.charAt(0))if(t.length>4)i.r=parseInt(t.substr(1,2),16),i.g=parseInt(t.substr(3,2),16),i.b=parseInt(t.substr(5,2),16);else{var n=t.charAt(1),s=t.charAt(2),r=t.charAt(3);i.r=parseInt(n+n,16),i.g=parseInt(s+s,16),i.b=parseInt(r+r,16)}else{var a=t.split(",");if(4==a.length){var h=a[0].split("("),l=a[3].split(")");i.r=parseInt(h[1]),i.g=parseInt(a[1]),i.b=parseInt(a[2]),i.a=parseFloat(l[0])}if(3==a.length){h=a[0].split("(");var c=a[2].split(")");i.r=parseInt(h[1]),i.g=parseInt(a[1]),i.b=parseInt(c[0])}}return i.color.notColor=e,i}function b(t){return t.getBoundingClientRect?w(t):x(t)}function x(t){for(var e=0,i=0;t;)e+=parseInt(t.offsetTop),i+=parseInt(t.offsetLeft),t=t.offsetParent;return{top:e,left:i}}function w(e){var i=e.getBoundingClientRect(),n=document.body||{},s=document.documentElement,r=t.pageYOffset||s.scrollTop||n.scrollTop,o=t.pageXOffset||s.scrollLeft||n.scrollLeft,a=s.clientTop||n.clientTop||0,h=s.clientLeft||n.clientLeft||0,l=i.top+r-a,c=i.left+o-h;return{top:et(l),left:et(c)}}function j(t,e){k(t,e),C(t,e)}function C(t,e){t.optns.focused&&(0!=e.keyDown.val&&"function"==typeof t.onkeydown&&t.onkeydown(e.keyDown),0!=e.keyUp.val&&"function"==typeof t.onkeyup&&t.onkeyup(e.keyUp),0!=e.keyPress.val&&"function"==typeof t.onkeypress&&t.onkeypress(e.keyPress))}function P(t,i,n){var s={},r=T(t),o=r.optns.ctx,a=r.layers[t.optns.layer.number];if(s.x=i,s.y=n,ht&&(s=v(i,n,a.matrix()),s=v(s.x,s.y,t.matrix())),o.isPointInPath===e||t._img!==e||t._imgData!==e||"text"==t._proto){var h=t.getRect("poor"),l=v(i,n,m(t.matrix(),a.matrix()));if(h.x<=l.x&&h.y<=l.y&&h.x+h.width>=l.x&&h.y+h.height>=l.y)return s}else if(o.isPointInPath(s.x,s.y))return s;return!1}function k(t,e){var i=!1,n=e.mousemove,s=e.mousedown,r=e.mouseup,o=e.click,a=e.dblclick,h=n.x||s.x||r.x||a.x||o.x,l=n.y||s.y||r.y||a.y||o.y;0!=h&&(i=P(t,h,l)),i&&(0!=n.x&&(n.object=t),0!=s.x&&(s.objects[s.objects.length]=t),0!=o.x&&(o.objects[o.objects.length]=t),0!=a.x&&(a.objects[a.objects.length]=t),0!=r.x&&(r.objects[r.objects.length]=t),e.point=i)}function I(t){return T(t).layers[t.optns.layer.number]}function T(t){return W[t.optns.canvas.number]}function M(t,i,n){a(i);var s=i.optns.canvas,r=i.optns.layer;if(t===e)return r.id;if(r.id==t)return i;var o={i:s.number,j:r.number};r.id=t;var h=lt.layer(t),l={i:h.optns.canvas.number,j:h.optns.number},c=W[o.i].layers[o.j][n],u=W[l.i].layers[l.j][n];return c.splice(i.optns.number,1),i._level=i.optns.number=u.length,u[i._level]=i,r.number=l.j,s.number=l.i,s.id=h.optns.canvas.id,a(i),i}function Y(t,i){for(var n in i)switch(typeof i[n]){case"function":if("on"==n.substr(0,2))break;t[n]===e&&(t[n]=i[n]);break;case"object":if("optns"==n||"animateQueue"==n)break;if("objs"==n||"grdntsnptrns"==n){for(var s in i[n])i[n].hasOwnProperty(s)&&i[n][s].clone().layer(t.optns.id);break}if(!i[n]||"ctx"===n)continue;t[n]="function"==typeof i[n].pop?[]:{},Y(t[n],i[n]);break;default:if("_level"==n)break;t[n]=i[n]}}function X(t,i,n){a(i);var s=i.optns.canvas,r=i.optns.layer;if(t===e)return W[s.number].optns.id;if(W[s.number].optns.id==t)return i;var o={i:s.number,j:r.number};lt.canvas(t);for(var h=0;h<W.length;h++){var l=W[h];if(l.optns.id==t){var c=W[o.i].layers[o.j][n],u=l.layers[0][n];c.splice(i.optns.number,1),N(c),i._level=i.optns.number=u.length,u[i._level]=i,r.number=0,s.number=h,s.id=l.optns.id,r.id=l.layers[0].optns.id}}return a(i),i}function N(t){for(var e=0;e<t.length;e++)t[e].optns.number=e}function O(t,e,i,n,s){for(var r,o,a,h=t.length,l=0;h>l;l++)r=t[l].optns,o=r.canvas,a=r.layer,o.id=n,o.number=s,a.id=e,a.number=i}function A(t){return t.sort(function(t,e){return t._level>e._level?1:t._level<e._level?-1:0}),N(t),t.length}function D(t){var e;do{e=!1;for(var i=0;i<t.length;i++)t[i].optns.deleted&&(t.splice(i,1),e=!0)}while(e);return N(t),t.length}function B(t){var e=new ft.layer;return e.base(t)}function R(){var t=new ft.group;return t.base()}function L(t,e,i){var n=i.drag;return i.drag.init&&i.drag.object?(1==t.optns.drop.val?(n.init==n.object&&n.init.visible(!0),"function"==typeof t.optns.drop.fn&&t.optns.drop.fn.call(t,n.init)):(n.object.visible(!1),n.init.visible(!0),n.init.optns.translateMatrix[0][2]=n.object.optns.translateMatrix[0][2],n.init.optns.translateMatrix[1][2]=n.object.optns.translateMatrix[1][2],r(n.init),n.object!=n.init&&n.object.visible(!1),"function"==typeof n.init.optns.drag.stop&&n.init.optns.drag.stop.call(n.init,{x:e.x,y:e.y})),n.x!=n.startX||n.y!==n.startY):!1}var W=[],H=Math,S=H.PI,G=2*S,E=0,F=!1,q=!1,Q=/[A-z]+?/,U=/\d.\w\w/,z=t.navigator.userAgent.match(/Firefox\/\w+\.\w+/i),K=180/S,$=H.max,J=H.min,V=H.cos,Z=H.sin,tt=H.floor,et=H.round,it=H.abs,nt=H.pow,st=H.sqrt,rt=1e3/60,ot=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t,e){return setTimeout(t,rt)}}(),at=function(){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout}();if(""!=z&&null!==z)var ht=parseInt(z[0].split(/[ \/\.]/i)[1])<7;var lt=function(t,r){if(t===e)return this;"object"==typeof t&&(r=t,t=e);var o,a,h,l,c,u,f,p=-1,m=-1,d=W.length,v=R();if(r===e){if("#"===t.charAt(0))for(o=0;d>o;o++)for(f=W[o].layers.length,a=0;f>a;a++)if(u=i(o,a,t))return u;if("."===t.charAt(0))for(o=0;d>o;o++)for(f=W[o].layers.length,a=0;f>a;a++)v=n(o,a,v,t)}else{if(r.canvas!==e)for(o=0;d>o;o++)if(W[o].optns.id==r.canvas){p=o,h=W[o];break}if(r.layer!==e)if(-1!=p){for(f=h.layers.length,o=0;f>o;o++)if(h.layers[o].optns.id==r.layer){m=o,l=h.layers[o];break}}else for(o=0;d>o;o++){for(c=W[o].layers,f=c.length,a=0;f>a;a++)if(c[a].optns.id==r.layer){p=o,m=a,h=W[o],l=h.layers[a];break}if(l>-1)break}if(0>m&&0>p)return R();if(0>m){if(c=h.layers,f=c.length,t===e)for(a=0;f>a;a++)v=s(p,a,v);else if("#"===t.charAt(0)){for(a=0;f>a;a++)if(u=i(p,a,t))return u}else if("."===t.charAt(0))for(a=0;f>a;a++)v=n(p,a,v,t)}else{if(t===e&&(v=s(p,m,v)),"#"===t.charAt(0))return i(p,m,t);"."===t.charAt(0)&&(v=n(p,m,v,t))}}return r===e||r.attrs===e&&r.fns===e?v.elements.length?v:R():v.find(r)},ct={linear:function(t,e){return t},exp:function(t,e){var i=e.n||2;return nt(t,i)},circ:function(t,e){return 1-st(1-t*t)},sine:function(t,e){return 1-Z((1-t)*S/2)},back:function(t,e){var i=e.n||2,n=e.x||1.5;return nt(t,i)*((n+1)*t-n)},elastic:function(t,e){var i=e.n||2,n=e.m||20,s=e.k||3,r=e.x||1.5;return nt(i,10*(t-1))*V(n*t*S*r/s)},bounce:function(t,e){for(var i=e.n||4,n=e.b||.25,s=[1],r=1;i>r;r++)s[r]=s[r-1]+nt(n,r/2);var o=2*s[i-1]-1;for(r=0;i>r;r++)if(o*t>=(r>0?2*s[r-1]-1:0)&&o*t<=2*s[r]-1)return nt(o*(t-(2*s[r]-1-nt(n,r/2))/o),2)+1-nt(n,r);return 1}},ut={color:{fn:function(t,e,i,n){var s,r,o;for(i=i[n],r=0;t>r;r++)for(o=0;e>o;o++)s=this.getPixel(r,o),s[i[0]]=2*s[i[0]]-s[i[1]]-s[i[2]],s[i[1]]=0,s[i[2]]=0,s[i[0]]=s[i[0]]>255?255:s[i[0]],this.setPixel(r,o,s)},matrix:{red:[0,1,2],green:[1,0,2],blue:[2,0,1]}},linear:{fn:function(t,e,i,n){var s,r,o,a,h,l,c=[];for(i=i[n],h=i.length,l=i[0].length,r=0;t>r;r++)for(c[r]=[],o=0;e>o;o++)for(c[r][o]=[0,0,0,1],h=0;3>h;h++)for(l=0;3>l;l++)for(s=this.getPixel(r-parseInt(h/2),o-parseInt(l/2)),a=0;3>a;a++)c[r][o][a]+=s[a]*i[h][l];for(r=0;t>r;r++)for(o=0;e>o;o++)this.setPixel(r,o,c[r][o])},matrix:{sharp:[[-.375,-.375,-.375],[-.375,4,-.375],[-.375,-.375,-.375]],blur:[[.111,.111,.111],[.111,.111,.111],[.111,.111,.111]]}}},ft={};ft.object=function(){this.getCenter=function(t){var e=this.getRect("poor"),i={x:(2*e.x+e.width)/2,y:(2*e.y+e.height)/2};return g(this,i,t)},this.position=function(){return d(this._x,this._y,m(this.matrix(),I(this).matrix()))},this.buffer=function(t){var i=this.optns.buffer;if(t===e)return i.val?i.cnv:!1;if(i.val===t)return this;if(t){var n=i.cnv=document.createElement("canvas"),s=i.ctx=n.getContext("2d"),r=i.rect=this.getRect(),o=this.transform();n.setAttribute("width",r.width),n.setAttribute("height",r.height),i.x=this._x,i.y=this._y,i.dx=this._transformdx,i.dy=this._transformdy,this._x=this._y=0,this.transform(1,0,0,1,-r.x+i.dx,-r.y+i.dy,!0),this.setOptns(s),Y(i.optns={},T(this).optns),i.optns.ctx=s,this.draw(i.optns),this._x=i.x,this._y=i.y,this.transform(o[0][0],o[1][0],o[0][1],o[1][1],r.x,r.y,!0),i.val=!0}else this.translate(-i.rect.x+i.dx,-i.rect.y+i.dy),this.optns.buffer={val:!1};return this},this.clone=function(t){var i=new ft[this._proto];return ft[this._proto].prototype.base.call(i),Y(i,this),i.layer(I(this).optns.id),Y(i.optns.transformMatrix,this.optns.transformMatrix),Y(i.optns.translateMatrix,this.optns.translateMatrix),Y(i.optns.scaleMatrix,this.optns.scaleMatrix),Y(i.optns.rotateMatrix,this.optns.rotateMatrix),t===e?i:i.animate(t)},this.shadow=function(t){for(var e in t)switch(e){case"x":this._shadowX=t.x;break;case"y":this._shadowY=t.y;break;case"blur":this._shadowBlur=t.blur;break;case"color":var i=_(t.color);this._shadowColor=t.color.val,this._shadowColorR=i.r,this._shadowColorG=i.g,this._shadowColorB=i.b,this._shadowColorA=i.a}return a(this),this},this.setOptns=function(t){t.globalAlpha=this._opacity,t.shadowOffsetX=this._shadowX,t.shadowOffsetY=this._shadowY,t.shadowBlur=this._shadowBlur,t.globalCompositeOperation=this._composite;var e=parseInt(this._shadowColorR),i=parseInt(this._shadowColorG),n=parseInt(this._shadowColorB),s=parseInt(100*this._shadowColorA)/100;return this._shadowColorRPrev!==e||this._shadowColorGPrev!==i||this._shadowColorBPrev!==n||this._shadowColorAPrev!==s?(t.shadowColor=this._shadowColor="rgba("+e+", "+i+", "+n+", "+s+")",this._shadowColorRPrev=e,this._shadowColorGPrev=i,this._shadowColorBPrev=n,this._shadowColorAPrev=s):t.shadowColor=this._shadowColor,t.transform(this._transform11,this._transform12,this._transform21,this._transform22,this._transformdx,this._transformdy),this},this.up=function(t){if(t===e&&(t=1),"top"==t)this.level(t);else{var i=I(this).objs[this.optns.number+t];i!==e&&(t=i._level+1-this._level),this.level(this._level+t)}return this},this.down=function(t){if(t==e&&(t=1),"bottom"==t)this.level(t);else{var i=I(this).objs[this.optns.number-t];i!==e&&(t=this._level-(i._level-1)),this.level(this._level-t)}return this},this.level=function(t){if(t==e)return this._level;var i=I(this);return"bottom"==t&&(t=0==this.optns.number?this._level:i.objs[0]._level-1),"top"==t&&(t=this.optns.number==i.objs.length?this._level:i.objs[i.objs.length-1]._level+1),this._level=t,i.optns.anyObjLevelChanged=!0,a(this),this},this.del=function(){this.optns.deleted=!0,I(this).optns.anyObjDeleted=!0,a(this)},this.focus=function(t){return t===e?(this.optns.focused=!0,"function"==typeof this.onfocus&&this.onfocus()):this.onfocus=t,this},this.blur=function(t){return t===e?(this.optns.focused=!1,"function"==typeof this.onblur&&this.onblur()):this.onblur=t,this},this.click=function(t){return f.call(this,t,"click")},this.dblclick=function(t){return f.call(this,t,"dblclick")},this.keypress=function(t){return p.call(this,t,"onkeypress")},this.keydown=function(t){return p.call(this,t,"onkeydown")},this.keyup=function(t){return p.call(this,t,"onkeyup")},this.mousedown=function(t){return f.call(this,t,"mousedown")},this.mouseup=function(t){return f.call(this,t,"mouseup")},this.mousemove=function(t){return f.call(this,t,"mousemove")},this.mouseover=function(t){return f.call(this,t,"mouseover")},this.mouseout=function(t){return f.call(this,t,"mouseout")},this.attr=function(t,i){if("object"==typeof t)var n=t;else{if(i===e)return this["_"+t];n={},n[t]=i}return this.animate(n)},this.queue=function(){var t,i,n,s,r=this.animateQueue.length,o=0,a=0,h=arguments;for(i=0;i<h.length;i++)if("function"==typeof h[i]&&(h[i].apply(this),h[i]=!1,i++,this.animateQueue.length>r)){for(n=r;n<this.animateQueue.length;n++)if(t=this.animateQueue[n],t.duration!==e){t.duration>o&&(o=t.duration,a=n);break}if(o){t=this.animateQueue[a],t.animateFn?(s=t.animateFn,t.animateFn=function(){s.apply(this),this.queue.apply(this,h)}):t.animateFn=function(){this.queue.apply(this,h)};break}}},this.stop=function(t,i){this.optns.animated=!1,i===e&&(i=!1),t===e&&(t=!1);for(var n=0;n<this.animateQueue.length;n++){var s=this.animateQueue[n];if(i&&s.animateFn.call(this),t)for(var r in s)s[r].from!==e&&(this[r]=s[r].to,l(r,this,s))}return this.animateQueue=[],this},this.animate=function(t,i,n,s,r){if(i===e?i=1:("function"==typeof i&&(r=i,i=1),"object"==typeof i&&(n=i,i=1)),n===e?n={fn:"linear",type:"in"}:("function"==typeof n&&(r=n,n={fn:"linear",type:"in"}),n.type===e&&(n.type="in")),s===e?s=!1:"function"==typeof s&&(r=s,s=!1),t.scale!==e&&(this._scaleX=this._scaleY=1,"object"!=typeof t.scale?t.scaleX=t.scaleY=t.scale:(t.scaleX=t.scale.x||1,t.scaleY=t.scale.y||1)),t.translate!==e&&(this._translateX=this._translateY=0,"object"!=typeof t.translate?t.translateX=t.translateY=t.translate:(t.translateX=t.translate.x||0,t.translateY=t.translate.y||0),t.translate=e),t.translateTo!==e){var o=this.position();this._translateToX=o.x,this._translateToY=o.y,"object"!=typeof t.translateTo?t.translateToX=t.translateToY=t.translateTo:(t.translateToX=t.translateTo.x||0,t.translateToY=t.translateTo.y||0),t.translateTo=e}if(t.rotate!==e&&(t.rotateAngle=t.rotate.angle,this._rotateAngle=0,this._rotateX=t.rotate.x||0,this._rotateY=t.rotate.y||0,t.rotate=e),t.color!==e){var h=_(t.color);h.color.notColor?this.optns.color.notColor=h.color.notColor:(t.colorR=h.r,t.colorG=h.g,t.colorB=h.b,t.alpha=h.a),t.color=e}if(t.shadowColor!==e&&(h=_(t.shadowColor),t.shadowColorR=h.r,t.shadowColorG=h.g,t.shadowColorB=h.b,t.shadowColorA=h.a,t.shadowColor=e),i>1){var l=this.animateQueue[this.animateQueue.length]={animateKeyCount:0};l.animateFn=r||!1,this.optns.animated=!0,l.duration=i,l.step=0,l.easing=n,l.onstep=s}for(var c in t)if(this["_"+c]!==e&&t[c]!==e){var u=t[c],f="_"+c;u!=this[f]&&(u.charAt&&("string"==c?this._string=u:"="==u.charAt(1)?u=this[f]+parseInt(u.charAt(0)+"1")*parseInt(u.substr(2)):Q.test(u)?this[f]=u:u=parseInt(u)),1==i?this[f]=u:(l[f]={from:this[f],to:u,prev:0},l.animateKeyCount++))}return 1==i&&(t.rotateAngle&&this.rotate(this._rotateAngle,this._rotateX,this._rotateY),(t.translateX||t.translateY)&&this.translate(this._translateX,this._translateY),(t.translateToX||t.translateToY)&&this.translate(this._translateToX,this._translateToY),(t.scaleX||t.scaleY)&&this.scale(this._scaleX,this._scaleY)),a(this),this},this.matrix=function(t){return t===e?[[this._transform11,this._transform21,this._transformdx],[this._transform12,this._transform22,this._transformdy]]:(this._transform11=t[0][0],this._transform21=t[0][1],this._transform12=t[1][0],this._transform22=t[1][1],this._transformdx=t[0][2],this._transformdy=t[1][2],this)},this.translateTo=function(t,i,n,s,r,o){if(n!==e)return this.animate({translateTo:{x:t,y:i}},n,s,r,o);var a=this.position(),h=0,l=0;return t!==e&&(h=t-a.x),i!==e&&(l=i-a.y),this.translate(h,l)},this.translate=function(t,i,n,s,o,a){return n!==e?this.animate({translate:{x:t,y:i}},n,s,o,a):(this.optns.translateMatrix=m(this.optns.translateMatrix,[[1,0,t],[0,1,i]]),r(this),this)},this.scale=function(t,i,n,s,o,a){return n!==e?this.animate({scale:{x:t,y:i}},n,s,o,a):(i===e&&(i=t),this.optns.scaleMatrix=m(this.optns.scaleMatrix,[[t,0,this._x*(1-t)],[0,i,this._y*(1-i)]]),r(this),this)},this.rotate=function(t,i,n,s,o,a,h){if(s!==e)return this.animate({rotate:{angle:t,x:i,y:n}},s,o,a,h);t/=K;var l=V(t),c=Z(t),u=0,f=0;if(i!==e){if("center"==i){var p=this.getCenter("poor");n===e?(i=p.x,n=p.y):(i=p.x+n.x,n=p.y+n.y)}u=-i*(l-1)+n*c,f=-n*(l-1)-i*c}return this.optns.rotateMatrix=m(this.optns.rotateMatrix,[[l,-c,u],[c,l,f]]),r(this),this},this.transform=function(t,i,n,s,o,a,h){if(t===e)return this.matrix();var l=this.optns;return h!==e?(l.transformMatrix=[[t,n,o],[i,s,a]],l.rotateMatrix=[[1,0,0],[0,1,0]],l.scaleMatrix=[[1,0,0],[0,1,0]],l.translateMatrix=[[1,0,0],[0,1,0]]):l.transformMatrix=m(l.transformMatrix,[[t,n,o],[i,s,a]]),r(this),this},this.beforeDraw=function(t){if(!this._visible)return!1;var e=t.ctx;if(e.save(),this.optns.clipObject){var i=this.optns.clipObject;i._visible=!0,i.optns.animated&&h.call(i,t),i.setOptns(e),e.beginPath(),i.draw(e),e.clip()}return this.setOptns(e),this.optns.animated&&h.call(this,t),e.beginPath(),!0},this.clip=function(t){return t===e?this.optns.clipObject:(I(this).objs.splice(t.optns.number,1),this.optns.clipObject=t,this)},this.afterDraw=function(t){t.ctx.closePath(),j(this,t),t.ctx.restore(),this.optns.clipObject&&ft.shape.prototype.afterDraw.call(this.optns.clipObject,t)},this.isPointIn=function(t,i,n){var s=T(this).optns,r=s.ctx,o=!1,a=this.optns,h=!1;if(n!==e&&(t-=s.x,i-=s.y),a.animated&&(o=!0),a.animated=!1,a.clipObject){var l=a.clipObject,c=l.optns;c.animated&&(h=!0,c.animated=!1)}I(this).setOptns(r),this.beforeDraw(s),this.draw(r);var u=P(this,t,i);return r.closePath(),r.restore(),r.setTransform(1,0,0,1,0,0),a.animated=o,h&&(c.animated=h),u},this.layer=function(t){return M(t,this,"objs")},this.canvas=function(t){return X(t,this,"objs")},this.draggable=function(t,i,n){if(i===e&&"object"==typeof t&&t.optns===e){i=t.params,n=t.drag;var s=t.start,r=t.stop,o=t.disabled;t=t.object}var a=this,h=this.optns.drag;"function"==typeof i&&(n=i,i=e),"function"==typeof t&&(n=t,t=e),h.shiftX=0,h.shiftY=0,i!==e&&(i.shiftX!==e&&(h.shiftX=i.shiftX,i.shiftX=e),i.shiftY!==e&&(h.shiftY=i.shiftY,i.shiftY=e)),t!==e&&(t.id&&(a=i===e?t.visible(!1):t.animate(i).visible(!1)),
"clone"==t&&(a=this.clone(i).visible(!1),h.type="clone")),h.val=!0,h.x=this._x,h.y=this._y,h.dx=this._transformdx,h.dy=this._transformdy,h.object=a,h.params=i,h.drag=n||!1,h.start=s||!1,h.stop=r||!1,h.disabled=o||!1;var l=T(this).optns;return l.mousemove.val=!0,l.mousedown.val=!0,l.mouseup.val=!0,this},this.droppable=function(t){return this.optns.drop.val=!0,t!==e&&(this.optns.drop.fn=t),this},this.name=function(t){return this.attr("name",t)},this.hasName=function(t){for(var e=this.attr("name").split(" "),i=0;i<e.length;){if(e[i]===t)return!0;i++}return!1},this.addName=function(t){for(var e=this.attr("name").split(" "),i=0;i<e.length;){if(e[i]===t)return this;i++}return e.push(t),this.attr("name",e.join(" "))},this.removeName=function(t){for(var e=this.attr("name").split(" "),i=0;i<e.length;){if(e[i]===t)return e.splice(i,1),this.attr("name",e.join(" "));i++}return this},this.visible=function(t){return this.attr("visible",t)},this.composite=function(t){return this.attr("composite",t)},this.id=function(t){return t===e?this.optns.id:(this.optns.id=t,this)},this.opacity=function(t){return this.attr("opacity",t)},this.fadeIn=function(t,e,i,n){return this.fadeTo(1,t,e,i,n)},this.fadeOut=function(t,e,i,n){return this.fadeTo(0,t,e,i,n)},this.fadeTo=function(t,i,n,s,r){return i===e&&(i=600),this.animate({opacity:t},i,n,s,r)},this.fadeToggle=function(t,e,i,n){return this._opacity?this.fadeOut(t,e,i,n):this.fadeIn(t,e,i,n),this},this.instanceOf=function(t){return t===e?this._proto:this instanceof ft[t]},this.base=function(t,i,n){"object"==typeof t?(t=o(t,{x:0,y:0,service:!1}),n=t.service,i=t.y,t=t.x):n===e&&(n=!1);var s=W[E];if(this.optns={animated:!1,clipObject:!1,drop:{val:!1,fn:function(){}},drag:{val:!1},layer:{id:s.optns.id+"Layer0",number:0},canvas:{number:0},focused:!1,buffer:{val:!1},rotateMatrix:[[1,0,0],[0,1,0]],scaleMatrix:[[1,0,0],[0,1,0]],translateMatrix:[[1,0,0],[0,1,0]],transformMatrix:[[1,0,0],[0,1,0]]},this.animateQueue=[],this._x=t,this._y=i,0==n&&s!==e&&s.layers[0]!==e){this.optns.layer.number=0,this.optns.canvas.number=E;var r=I(this),h=r.objs.length;this.optns.number=h,this._level=h?r.objs[h-1]._level+1:0,r.objs[h]=this,this.optns.layer.id=r.optns.id,a(this)}return this},this._visible=!0,this._composite="source-over",this._name="",this._opacity=1,this._shadowX=0,this._shadowY=0,this._shadowBlur=0,this._shadowColor="rgba(0,0,0,0)",this._shadowColorR=0,this._shadowColorG=0,this._shadowColorB=0,this._shadowColorA=0,this._shadowColorRPrev=0,this._shadowColorGPrev=0,this._shadowColorBPrev=0,this._shadowColorAPrev=0,this._translateX=0,this._translateY=0,this._scaleX=1,this._scaleY=1,this._rotateAngle=0,this._rotateX=0,this._rotateY=0,this._transform11=1,this._transform12=0,this._transform21=0,this._transform22=1,this._transformdx=0,this._transformdy=0,this._matrixChanged=!1},ft.object.prototype=new ft.object,ft.shape=function(){this.color=function(t){return t===e?[this._colorR,this._colorG,this._colorB,this._alpha]:this.attr("color",t)},this.lineStyle=function(t){return this.attr(t)},this.setOptns=function(t){ft.shape.prototype.setOptns.call(this,t),t.lineWidth=this._lineWidth,t.lineCap=this._cap,t.lineJoin=this._join,t.miterLimit=this._miterLimit;var i=this.optns.color;if(i.notColor===e){var n=parseInt(this._colorR),s=parseInt(this._colorG),r=parseInt(this._colorB),o=parseInt(100*this._alpha)/100;this._colorRPrev!==n||this._colorGPrev!==s||this._colorBPrev!==r||this._alphaPrev!==o?(i.val=this._color="rgba("+n+", "+s+", "+r+", "+o+")",this._colorRPrev=n,this._colorGPrev=s,this._colorBPrev=r,this._alphaPrev=o):i.val=this._color}else{var a=i.notColor,h=W[a.canvas].layers[a.layer];h.grdntsnptrns[a.level]!==e&&(i.val=h.grdntsnptrns[a.level].val)}this._fill?t.fillStyle=i.val:t.strokeStyle=i.val},this.afterDraw=function(t){this._fill?t.ctx.fill():t.ctx.stroke(),ft.shape.prototype.afterDraw.call(this,t)},this.base=function(t){return t===e&&(t={}),t.color===e?t.color="rgba(0,0,0,1)":t.color.charAt||t.color.id!==e||t.color.r!==e||(t.fill=t.color,t.color="rgba(0,0,0,1)"),t=o(t,{color:"rgba(0,0,0,1)",fill:0}),ft.shape.prototype.base.call(this,t),this._fill=t.fill,this.optns.color={val:t.color,notColor:e},this.color(t.color)},this._colorR=0,this._colorG=0,this._colorB=0,this._alpha=0,this._colorRPrev=0,this._colorGPrev=0,this._colorBPrev=0,this._alphaPrev=0,this._color="rgba(0,0,0,0)",this._lineWidth=1,this._cap="butt",this._join="miter",this._miterLimit=1},ft.shape.prototype=new ft.object,ft.lines=function(){this.getCenter=function(t){for(var e={x:this._x0,y:this._y0},i=1;i<this.shapesCount;i++)e.x+=this["_x"+i],e.y+=this["_y"+i];return e.x=e.x/this.shapesCount,e.y=e.y/this.shapesCount,g(this,e,t)},this.position=function(){return d(this._x0,this._y0,m(this.matrix(),I(this).matrix()))},this.getRect=function(t){for(var e,i,n=e=this._x0,s=i=this._y0,r=1;r<this.shapesCount;r++)n<this["_x"+r]&&(n=this["_x"+r]),s<this["_y"+r]&&(s=this["_y"+r]),e>this["_x"+r]&&(e=this["_x"+r]),i>this["_y"+r]&&(i=this["_y"+r]);var o={x:e,y:i,width:n-e,height:s-i};return y(this,o,t)},this.addPoint=function(){a(this);for(var t=this.pointNames,e=0;e<t.length;e++)this[t[e]+this.shapesCount]=arguments[e];return this.shapesCount++,this},this.delPoint=function(t,i,n){if(a(this),i===e){var s=this.points();s.splice(t,1),this.points(s)}else{n=n||0;for(var r=0;r<this.shapesCount;r++)this["_x"+r]<t+n&&this["_x"+r]>t-n&&this["_y"+r]<i+n&&this["_y"+r]<i+n&&(this.delPoint(r),r--)}return this},this.points=function(t){var i=this.pointNames;if(t===e){t=[];for(var n=0;n<this.shapesCount;n++){t[n]=[];for(var s=0;s<i.length;s++)t[n][s]=this[i[s]+n]}return t}a(this);var r=this.shapesCount;for(this.shapesCount=t.length,n=0;n<this.shapesCount;n++)for(s=0;s<i.length;s++)this[i[s]+n]=t[n][s];for(n=this.shapesCount;r>n;n++)for(s=0;s<i.length;s++)this[i[s]+n]=e;return this},this.base=function(t,i,n){return t!==e&&"function"==typeof t.pop&&(t={points:t,color:i,fill:n}),ft.lines.prototype.base.call(this,t),this.shapesCount=0,t!==e&&t.points!==e&&this.points(t.points),this}},ft.lines.prototype=new ft.shape,ft.line=function(){this.draw=function(t){if(this._x0!==e){t.moveTo(this._x0,this._y0);for(var i=1;i<this.shapesCount;i++)t.lineTo(this["_x"+i],this["_y"+i])}},this.base=function(t,e,i){return ft.line.prototype.base.call(this,t,e,i),this},this._proto="line",this.pointNames=["_x","_y"]},ft.line.prototype=new ft.lines,ft.qCurve=function(){this.draw=function(t){if(this._x0!==e){t.moveTo(this._x0,this._y0);for(var i=1;i<this.shapesCount;i++)t.quadraticCurveTo(this["_cp1x"+i],this["_cp1y"+i],this["_x"+i],this["_y"+i])}},this.base=function(t,e,i){return ft.qCurve.prototype.base.call(this,t,e,i),this},this._proto="qCurve",this.pointNames=["_x","_y","_cp1x","_cp1y"]},ft.qCurve.prototype=new ft.lines,ft.bCurve=function(){this.draw=function(t){if(this._x0!==e){t.moveTo(this._x0,this._y0);for(var i=1;i<this.shapesCount;i++)t.bezierCurveTo(this["_cp1x"+i],this["_cp1y"+i],this["_cp2x"+i],this["_cp2y"+i],this["_x"+i],this["_y"+i])}},this.base=function(t,e,i){return ft.bCurve.prototype.base.call(this,t,e,i),this},this._proto="bCurve",this.pointNames=["_x","_y","_cp1x","_cp1y","_cp2x","_cp2y"]},ft.bCurve.prototype=new ft.lines,ft.circle=function(){this.getCenter=function(t){return g(this,{x:this._x,y:this._y},t)},this.getRect=function(t){var e={x:Math.floor(this._x-this._radius),y:Math.floor(this._y-this._radius)};return e.width=e.height=2*Math.ceil(this._radius),y(this,e,t)},this.draw=function(t){t.arc(this._x,this._y,this._radius,0,G,!0)},this.base=function(t,e,i,n,s){return"object"!=typeof t&&(t={x:t,y:e,radius:i,color:n,fill:s}),t=o(t,{radius:0}),ft.circle.prototype.base.call(this,t),this._radius=t.radius,this},this._proto="circle"},ft.circle.prototype=new ft.shape,ft.rect=function(){this.getRect=function(t){return y(this,{x:this._x,y:this._y,width:this._width,height:this._height},t)},this.draw=function(t){t.rect(this._x,this._y,this._width,this._height)},this.base=function(t,e,i,n,s,r){return"object"!=typeof t&&(t={x:t,y:e,width:i,height:n,color:s,fill:r}),t=o(t,{width:0,height:0}),ft.rect.prototype.base.call(this,t),this._width=t.width,this._height=t.height,this},this._proto="rect"},ft.rect.prototype=new ft.shape,ft.arc=function(){this.getRect=function(t){var e={x:this._x,y:this._y},i=this._startAngle,n=this._endAngle,s=this._radius,r=tt(Z(i/K)*s),o=tt(V(i/K)*s),a=tt(Z(n/K)*s),h=tt(V(n/K)*s),l=o>0&&h>0,c=0>o&&0>h,u=r>0&&a>0,f=0>r&&0>a;return e.width=e.height=s,this._anticlockwise&&n>i||!this._anticlockwise&&i>n?(c||l&&(f||u)||0==o&&0==h?(e.y-=s,e.height+=s):l&&0>a&&r>0?(e.y+=a,e.height+=a):h>0&&0>a&&0>o?(e.y+=J(a,r),e.height-=J(a,r)):(f?e.y-=$(a,r):e.y-=s,e.height+=$(a,r)),u||f&&(c||l)||0==r&&0==a?(e.x-=s,e.width+=s):0>a&&r>0?(e.x+=J(h,o),e.width-=J(h,o)):(c?e.x-=$(h,o):e.x-=s,e.width+=$(h,o))):(l=o>=0&&h>=0,u=r>=0&&a>=0,c=0>=o&&0>=h,f=0>=r&&0>=a,f&&l?(e.x+=J(h,o),e.width-=J(h,o),e.y+=J(a,r),e.height+=$(a,r)):f&&c?(e.x+=J(h,o),e.width+=$(h,o),e.y+=J(a,r),e.height+=$(a,r)):f?(e.x+=J(h,o),e.width+=$(h,o),e.y-=s,e.height+=$(a,r)):l&&u?(e.x+=J(h,o),e.width=it(h-o),e.y+=J(a,r),e.height-=J(a,r)):u?(e.x+=J(h,o),e.width=it(h)+it(o),e.y+=J(a,r),e.height-=J(a,r)):c?(e.x-=s,e.width+=$(h,o),e.y-=s,e.height+=$(a,r)):l&&(e.x-=s,e.width+=$(h,o),e.y-=s,e.height+=s)),y(this,e,t)},this.draw=function(t){t.arc(this._x,this._y,this._radius,this._startAngle/K,this._endAngle/K,this._anticlockwise)},this.base=function(t,i,n,s,r,a,h,l){return a!==e&&(a.charAt&&(h=a),a=a?!0:!1),"object"!=typeof t&&(t={x:t,y:i,radius:n,startAngle:s,endAngle:r,anticlockwise:a,color:h,fill:l}),t=o(t,{radius:0,startAngle:0,endAngle:0,anticlockwise:!0}),ft.arc.prototype.base.call(this,t),this._radius=t.radius,this._startAngle=t.startAngle,this._endAngle=t.endAngle,this._anticlockwise=t.anticlockwise,this},this._proto="arc"},ft.arc.prototype=new ft.shape,ft.text=function(){this.font=function(t){return this.attr("font",t)},this._font="10px sans-serif",this.align=function(t){return this.attr("align",t)},this._align="start",this.baseline=function(t){return this.attr("baseline",t)},this._baseline="alphabetic",this.string=function(t){return this.attr("string",t)},this.position=function(){var t={x:this._x,y:this._y},e=T(this).optns.ctx;return t.height=parseInt(this._font.match(U)[0]),t.y-=t.height,e.save(),e.textBaseline=this._baseline,e.font=this._font,e.textAlign=this._align,t.width=e.measureText(this._string).width,e.restore(),y(this,t)},this.getRect=function(t){var e={x:this._x,y:this._y},i=T(this).optns.ctx;return e.height=parseInt(this._font.match(U)[0]),e.y-=e.height,i.save(),i.textBaseline=this._baseline,i.font=this._font,i.textAlign=this._align,e.width=i.measureText(this._string).width,"center"==this._align&&(e.x-=e.width/2),"right"==this._align&&(e.x-=e.width),i.restore(),y(this,e,t)},this.setOptns=function(t){ft.text.prototype.setOptns.call(this,t),t.textBaseline=this._baseline,t.font=this._font,t.textAlign=this._align},this.draw=function(t){this._maxWidth===!1?this._fill?t.fillText(this._string,this._x,this._y):t.strokeText(this._string,this._x,this._y):this._fill?t.fillText(this._string,this._x,this._y,this._maxWidth):t.strokeText(this._string,this._x,this._y,this._maxWidth)},this.base=function(t,i,n,s,r,a){return s!==e&&s.charAt&&(r!==e&&(a=r),r=s,s=!1),"object"!=typeof t&&(t={string:t,x:i,y:n,maxWidth:s,color:r,fill:a}),t=o(t,{string:"",maxWidth:!1,fill:1}),ft.text.prototype.base.call(this,t),this._string=t.string,this._maxWidth=t.maxWidth,this},this._proto="text"},ft.text.prototype=new ft.shape,ft.grdntsnptrn=function(){this.layer=function(t){return M(t,this,"grdntsnptrns")},this.canvas=function(t){return X(t,this,"grdntsnptrns")};var t=new ft.object;return this.animate=t.animate,this.attr=t.attr,this.id=t.id,this.name=t.name,this.level=t.level,this.base=function(){this.animateQueue=[],this.optns={animated:!1,name:"",layer:{id:W[0].optns.id+"Layer_0",number:0},canvas:{number:0},visible:!0},this.optns.layer.id=W[E].optns.id+"Layer_0",this.optns.layer.number=0,this.optns.canvas.number=E;var t=W[E].layers[0].grdntsnptrns;this._level=t.length,t[this._level]=this,a(this)},this},ft.gradients=function(){this.colorStopsCount=0,this.paramNames=["_pos","_colorR","_colorG","_colorB","_alpha"],this.addColorStop=function(t,e){a(this);var i=_(e),n=this.colorStopsCount;return this["_pos"+n]=t,this["_colorR"+n]=i.r,this["_colorG"+n]=i.g,this["_colorB"+n]=i.b,this["_alpha"+n]=i.a,this.colorStopsCount++,this},this.animate=function(t,e,i,n,s){for(var r in t)if("color"==r.substr(0,5)){var o=r.substring(5),a=_(t[r]);t["colorR"+o]=a.r,t["colorG"+o]=a.g,t["colorB"+o]=a.b,t["alpha"+o]=a.a}ft.gradients.prototype.animate.call(this,t,e,i,n,s)},this.delColorStop=function(t){a(this);var e=this.colorStops();return e.splice(t,1),e.length>0?this.colorStops(e):this.colorStopsCount=0,this},this.colorStops=function(t){var i=this.paramNames;if(t===e){t=[];for(var n=0;n<this.colorStopsCount;n++){t[n]=[];for(var s=0;s<i.length;s++)t[n][s]=this[i[s]+n]}return t}a(this);var r=this.colorStopsCount,o=t.length;if(2==t[0].length)for(n=0;o>n;n++)this.addColorStop(t[n][0],t[n][1]);else for(n=0;o>n;n++)for(s=0;s<i.length;s++)this[i[s]+n]=t[n][s];for(n=o;r>n;n++)for(s=0;s<i.length;s++)this[i[s]+n]=e;return this.colorStopsCount=o,this},this.base=function(t){return ft.gradients.prototype.base.call(this),t==e?this:this.colorStops(t)}},ft.gradients.prototype=new ft.grdntsnptrn,ft.pattern=function(){this.create=function(t){this.optns.animated&&h.call(this,t),this.val=t.ctx.createPattern(this._img,this._type)},this.base=function(t,e){return t.onload&&(t={image:t,type:e}),t=o(t,{type:"repeat"}),ft.pattern.prototype.base.call(this),this._img=t.image,this._type=t.type,this},this._proto="pattern"},ft.pattern.prototype=new ft.grdntsnptrn,ft.lGradient=function(){this.create=function(t){this.optns.animated&&h.call(this,t),this.val=t.ctx.createLinearGradient(this._x1,this._y1,this._x2,this._y2);for(var e=0;e<this.colorStopsCount;e++)this.val.addColorStop(this["_pos"+e],"rgba("+parseInt(this["_colorR"+e])+","+parseInt(this["_colorG"+e])+","+parseInt(this["_colorB"+e])+","+this["_alpha"+e]+")")},this.base=function(t,e,i,n,s){return"object"!=typeof t&&(t={x1:t,y1:e,x2:i,y2:n,colors:s}),t=o(t,{x1:0,y1:0,x2:0,y2:0}),ft.lGradient.prototype.base.call(this,t.colors),this._x1=t.x1,this._y1=t.y1,this._x2=t.x2,this._y2=t.y2,this},this._proto="lGradient"},ft.lGradient.prototype=new ft.gradients,ft.rGradient=function(){this.create=function(t){this.optns.animated&&h.call(this),this.val=t.ctx.createRadialGradient(this._x1,this._y1,this._r1,this._x2,this._y2,this._r2);for(var e=0;e<this.colorStopsCount;e++)this.val.addColorStop(this["_pos"+e],"rgba("+parseInt(this["_colorR"+e])+","+parseInt(this["_colorG"+e])+","+parseInt(this["_colorB"+e])+","+this["_alpha"+e]+")")},this.base=function(t,e,i,n,s,r,a){return"object"!=typeof t&&(t={x1:t,y1:e,r1:i,x2:n,y2:s,r2:r,colors:a}),t=o(t,{x1:0,y1:0,r1:0,x2:0,y2:0,r2:0}),ft.rGradient.prototype.base.call(this,t.colors),this._x1=t.x1,this._y1=t.y1,this._r1=t.r1,this._x2=t.x2,this._y2=t.y2,this._r2=t.r2,this},this._proto="rGradient"},ft.rGradient.prototype=new ft.gradients,ft.layer=function(){this.position=function(){var t,i,n,s=this.objs,r=s.length;for(n=0;r>n;n++)i=s[n].position(),t===e&&(t=i),t.x>i.x&&(t.x=i.x),t.y>i.y&&(t.y=i.y);return t},this.getRect=function(t){var i,n,s,r=this.objs,o=r.length;if(0==r.length)return!1;if("coords"==t){for(s=0;o>s;s++)n=r[s].getRect(t),i===e&&(i=n),i[0][0]>n[0][0]&&(i[0][0]=n[0][0]),i[0][1]>n[0][1]&&(i[0][1]=n[0][1]),i[1][0]<n[1][0]&&(i[1][0]=n[1][0]),i[1][1]>n[1][1]&&(i[1][1]=n[1][1]),i[2][0]>n[2][0]&&(i[2][0]=n[2][0]),i[2][1]<n[2][1]&&(i[2][1]=n[2][1]),i[3][0]<n[3][0]&&(i[3][0]=n[3][0]),i[3][1]<n[3][1]&&(i[3][1]=n[3][1]);return i}for(s=0;o>s;s++)n=r[s].getRect(t),n.right=n.width+n.x,n.bottom=n.height+n.y,i===e&&(i=n),i.x>n.x&&(i.x=n.x),i.y>n.y&&(i.y=n.y),i.right<n.right&&(i.right=n.right),i.bottom<n.bottom&&(i.bottom=n.bottom);return i.width=i.right-i.x,i.height=i.bottom-i.y,i},this.canvas=function(t){if(t===e)return this.idCanvas;if(this.optns.canvas.id==t)return this;for(var i=-1,n=0,s=W.length,r=0;s>r;r++){var o=W[r].optns.id;o==t&&(i=r),o==this.optns.canvas.id&&(n=r)}0>i&&(i=W.length,lt.canvas(t)),this.optns.canvas.id=t,this.optns.canvas.number=i,W[n].layers.splice(this.optns.number,1);var a=W[i].layers;return this._level=this.optns.number=a.length,a[this._level]=this,O(this.objs,this.optns.id,this._level,t,i),O(this.grdntsnptrns,this.optns.id,this._level,t,i),W[i].optns.redraw=1,this},this.up=function(t){if(t===e&&(t=1),"top"==t)this.level(t);else{var i=T(this).layers[this.optns.number+t];i!==e&&(t=i._level+1-this._level),this.level(this._level+t)}return this},this.down=function(t){if(t==e&&(t=1),"bottom"==t)this.level(t);else{var i=T(this).layers[this.optns.number-t];i!==e&&(t=this._level-(i._level-1)),this.level(this._level-t)}return this},this.level=function(t){if(t==e)return this._level;var i=T(this),n=i.optns;return"bottom"==t&&(t=0==this.optns.number?this._level:i.layers[0]._level-1),"top"==t&&(t=this.optns.number==i.layers.length-1?this._level:i.layers[i.layers.length-1]._level+1),this._level=t,n.anyLayerLevelChanged=!0,n.redraw=1,this},this.del=function(){var t=T(this).optns;t.anyLayerDeleted=!0,this.optns.deleted=!0,this.draw=!1,t.redraw=1},this.setOptns=function(t){return t.setTransform(1,0,0,1,0,0),ft.layer.prototype.setOptns.call(this,t),this},this.afterDraw=function(t){t.ctx.closePath(),t.ctx.restore(),this.optns.clipObject&&ft.layer.prototype.afterDraw.call(this.optns.clipObject,t)},this.clone=function(t,i){var n=lt.layer(t);return Y(n,this),Y(n.optns.transformMatrix,this.optns.transformMatrix),Y(n.optns.translateMatrix,this.optns.translateMatrix),Y(n.optns.scaleMatrix,this.optns.scaleMatrix),Y(n.optns.rotateMatrix,this.optns.rotateMatrix),n.canvas(T(this).optns.id),i===e?n:n.animate(i)},this.isPointIn=function(t,e,i){var n,s=this.objs;for(n=0;n<s.length;n++)if(s[n].isPointIn(t,e,i))return!0;return!1},this.opacity=function(t){for(var e=this.objs,i=0;i<e.length;i++)e[i].attr("opacity",t);return this},this.fadeTo=function(t,i,n,s,r){i===e&&(i=600);for(var o=this.objs,a=0;a<o.length;a++)o[a].animate({opacity:t},i,n,s,r);return this},this.draw=function(t){var e=this.optns,i=e.buffer,n=t.ctx;if(i.val)return n.drawImage(i.cnv,i.x,i.y),this;for(var s=0;s<this.grdntsnptrns.length;s++)this.grdntsnptrns[s].create(t);for(e.anyObjLevelChanged&&(A(this.objs),e.anyObjLevelChanged=!1),e.anyObjDeleted&&(D(this.objs),e.anyObjDeleted=!1),n.globalCompositeOperation=e.gCO,s=0;s<this.objs.length;s++){var r=this.objs[s];if("function"==typeof r.draw&&(this.setOptns(n),r.beforeDraw(t)&&"function"==typeof r.draw)){var o=r.optns.buffer;o.val?n.drawImage(o.cnv,o.x,o.y):r.draw(n),i.optns?r.afterDraw(i.optns):r.afterDraw(t)}}return this},this.objects=function(t){for(var i=R(),n=0;this.objs[n]!==e;)i.elements[n]=this.objs[n++];return t!==e?i.find(t):i},this.base=function(t){var e=W[E],i=e.layers,n=e.optns;ft.layer.prototype.base.call(this,0,0,!0);var s=i.length;i[s]=this,this.objs=[],this.grdntsnptrns=[],this._level=s?i[s-1]._level+1:0,this.optns.number=s,this.optns.id=t;var r=this.optns;return r.anyObjDeleted=!1,r.anyObjLevelChanged=!1,r.gCO=n.gCO,r.canvas.id=n.id,r.canvas.number=E,this},this._proto="layer"},ft.layer.prototype=new ft.object,ft.imageData=function(){this.filter=function(t,e){var i=ut[t];return i.fn.call(this,this._width,this._height,i.matrix,e),this},this.getRect=function(t){var e={x:this._x,y:this._y,width:this._width,height:this._height};return y(this,e,t)},this.setPixel=function(t,i,n){var s,r=4*(t+i*this._width);return n.r!==e?s=n:n[0]!==e&&(s=n.charAt?_(n):{r:n[0],g:n[1],b:n[2],a:n[3]}),this._data[r+0]=s.r,this._data[r+1]=s.g,this._data[r+2]=s.b,this._data[r+3]=255*s.a,a(this),this},this.getPixel=function(t,e){var i=4*(t+e*this._width);return[this._data[i+0],this._data[i+1],this._data[i+2],this._data[i+3]/255]},this._getX=0,this._getY=0,this.getData=function(t,e,i,n){this._getX=t,this._getY=e,this._width=i,this._height=n;var s=T(this).optns.ctx;try{this._imgData=s.getImageData(this._getX,this._getY,this._width,this._height)}catch(r){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),this._imgData=s.getImageData(this._getX,this._getY,this._width,this._height)}return this._data=this._imgData.data,a(this),this},this.putData=function(t,i){return t!==e&&(this._x=t),i!==e&&(this._y=i),this._putData=!0,a(this),this},this.clone=function(){var t=ft.imageData.prototype.clone.call(this);return t._imgData=e,t},this.draw=function(t){if(this._imgData===e){this._imgData=t.createImageData(this._width,this._height);for(var i=0;i<this._width*this._height*4;i++)this._imgData.data[i]=this._data[i];this._data=this._imgData.data}this._putData&&t.putImageData(this._imgData,this._x,this._y)},this.base=function(t,i){if(ft.imageData.prototype.base.call(this),i===e){var n=t;n._width!==e?(t=n._width,i=n._height):(t=o(t,{width:0,height:0}),i=t.height,t=t.width)}this._width=t,this._height=i,this._data=[];for(var s=0;s<this._width;s++)for(var r=0;r<this._height;r++){var a=4*(s+r*this._width);this._data[a+0]=0,this._data[a+1]=0,this._data[a+2]=0,this._data[a+3]=0}return this},this._putData=!1,this._proto="imageData"},ft.imageData.prototype=new ft.object,ft.image=function(){this.getRect=function(t){var e={x:this._x,y:this._y,width:this._width,height:this._height};return y(this,e,t)},this.draw=function(t){t.drawImage(this._img,this._sx,this._sy,this._swidth,this._sheight,this._x,this._y,this._width,this._height)},this.base=function(t,i,n,s,r,a,h,l,c){return("object"!=typeof t||t.src!==e||t.nodeName!==e)&&(t={image:t,x:i,y:n,width:s,height:r,sx:a,sy:h,swidth:l,sheight:c}),t=o(t,{width:!1,height:!1,sx:0,sy:0,swidth:!1,sheight:!1}),t.width===!1&&(t.width=t.image.width,t.height=t.image.height),t.swidth===!1&&(t.swidth=t.image.width,t.sheight=t.image.height),ft.image.prototype.base.call(this,t),this._img=t.image,this._width=t.width,this._height=t.height,this._sx=t.sx,this._sy=t.sy,this._swidth=t.swidth,this._sheight=t.sheight,this},this._proto="image"},ft.image.prototype=new ft.object,ft.groups=function(){for(var t in ft)if("group"!=t&&"groups"!=t){var i=new ft[t];for(var n in i)"function"==typeof i[n]&&this[n]===e&&!function(t,i){t[i]=function(){for(var t=[],n=[],s=0;arguments[s]!==e;)n[s]=arguments[s++];for(s=0;s<this.elements.length;s++){var r=this.elements[s];Y(t,n),"function"==typeof r[i]&&r[i].apply(r,t)}return this}}(this,n)}this.reverse=function(){var t=this.elements;return this.elements=this.unmatchedElements,this.unmatchedElements=t,this},this.end=function(t){return this.previousGroup===e||0===t?this:(t!==e&&t--,this.previousGroup.end(t))},this.find=function(t){var i,n,s,r,o,a,h,l=R(),c=t.attrs,u=t.fns||[];for(l.previousGroup=this,i=0;i<this.elements.length;i++)l.elements[i]=this.elements[i];if(c!==e)for(n in c)c.hasOwnProperty(n)&&("object"!=typeof c[n]&&(c[n]={val:c[n],rel:"=="}),u[u.length]={fn:"attr",args:[n],val:c[n].val,rel:c[n].rel});if(u.length)for(i=0;i<l.elements.length;i++)for(s=l.elements[i],n=0;n<u.length;n++){switch(o=u[n],h=o.val,r=o.rel,"function"==typeof s[o.fn]?a=s[o.fn].apply(s,o.args):r="del",r){case"!=":a==h&&(r="del");break;case"!==":a===h&&(r="del");break;case"==":a!=h&&(r="del");break;case"===":a!==h&&(r="del");break;case">=":a>=h||(r="del");break;case"<=":h>=a||(r="del");break;case">":a>h||(r="del");break;case"<":h>a||(r="del");break;case"typeof":typeof a!=h&&(r="del")}if("del"==r){l.unmatchedElements[l.unmatchedElements.length]=s,l.elements.splice(i,1),i--;break}}return l},this.base=function(){return this.elements=[],this.unmatchedElements=[],this}},ft.group=function(){this._proto="group"},ft.group.prototype=new ft.groups,lt.addFunction=function(t,e,i){return ft[i||"object"].prototype[t]=e,lt},lt.addObject=function(t,i,n,s){ft[t]=function(t){this.draw=ft[t].draw,this.base=ft[t].base,this._proto=t};var r=ft[t];return s===e&&(s="shape"),r.prototype=new ft[s],r.draw=n,r.base=function(t,i,n){r.prototype.base.call(this,i);var s=0;for(var o in i){var a=n[s]!==e?n[s]:i[o];this["_"+o]=a,"color"==o&&this.color(a),s++}return this},function(t,e){lt[t]=function(){var i=new ft[t](t);return i.base(t,e,arguments)}}(t,i),lt},lt.addAnimateFunction=function(t,e){return ct[t]=e,lt},lt.addImageDataFilter=function(t,i){return ut[t]===e&&(ut[t]={}),i.fn!==e&&(ut[t].fn=i.fn),i.matrix!==e&&i.type===e&&(ut[t].matrix=i.matrix),i.type!==e&&(ut[t].matrix[type]=i.matrix),lt},lt.clear=function(t){return W[0]===e?lt:t===e?(W[0].clear(),lt):(lt.canvas(t).clear(),lt)},lt.pause=function(t){return t===e?(W[0].pause(),lt):(lt.canvas(t).pause(),lt)},lt.start=function(t,e){return lt.canvas(t).start(e),lt},lt.pattern=function(t,e){var i=new ft.pattern;return i.base(t,e)},lt.lGradient=function(t,e,i,n,s){var r=new ft.lGradient;return r.base(t,e,i,n,s)},lt.rGradient=function(t,e,i,n,s,r,o){var a=new ft.rGradient;return a.base(t,e,i,n,s,r,o)},lt.line=function(t,e,i){var n=new ft.line;return n.base(t,e,i)},lt.qCurve=function(t,e,i){var n=new ft.qCurve;return n.base(t,e,i)},lt.bCurve=function(t,e,i){var n=new ft.bCurve;return n.base(t,e,i)},lt.imageData=function(t,e){var i=new ft.imageData;return i.base(t,e)},lt.image=function(t,e,i,n,s,r,o,a,h){var l=new ft.image;return l.base(t,e,i,n,s,r,o,a,h)},lt.circle=function(t,e,i,n,s){var r=new ft.circle;return r.base(t,e,i,n,s)},lt.rect=function(t,e,i,n,s,r){var o=new ft.rect;return o.base(t,e,i,n,s,r)},lt.arc=function(t,e,i,n,s,r,o,a){var h=new ft.arc;return h.base(t,e,i,n,s,r,o,a)},lt.text=function(t,e,i,n,s,r){var o=new ft.text;return o.base(t,e,i,n,s,r)},lt.canvas=function(t){if(t===e)return W[0];for(var i=W.length,n=0;i>n;n++)if(W[n].optns&&W[n].optns.id==t)return W[n];var s={id:function(t){return t===e?this.optns.id:(this.optns.id=t,this)}};return W[i]=s,E=i,s.cnv=document.getElementById(t),s.width=function(t){return t===e?this.cnv.width:(this.optns.width=this.cnv.width=t,this.cnv.style.width=t+"px",this.optns.redraw=1,this)},s.height=function(t){return t===e?this.cnv.height:(this.optns.heigth=this.cnv.height=t,this.cnv.style.height=t+"px",this.optns.redraw=1,this)},s.optns={id:t,number:E,ctx:s.cnv.getContext("2d"),width:s.cnv.offsetWidth||s.cnv.width,height:s.cnv.offsetHeight||s.cnv.height,anyLayerDeleted:!1,anyLayerLevelChanged:!1,keyDown:{val:!1,code:!1},keyUp:{val:!1,code:!1},keyPress:{val:!1,code:!1},mousemove:{val:!1,x:!1,y:!1,object:!1},click:{val:!1,x:!1,y:!1,objects:[]},dblclick:{val:!1,x:!1,y:!1,objects:[]},mouseup:{val:!1,x:!1,y:!1,objects:[]},mousedown:{val:!1,x:!1,y:!1,objects:[]},drag:{object:!1,x:0,y:0},gCO:"source-over",redraw:1},s.toDataURL=function(){return s.cnv.toDataURL.apply(s.cnv,arguments)},s.layers=[],s.interval=0,lt.layer(t+"Layer_0").canvas(t),s.recalculateOffset=function(){var t=b(this.cnv);return this.optns.x=t.left+(parseInt(this.cnv.style.borderTopWidth)||0),this.optns.y=t.top+(parseInt(this.cnv.style.borderLeftWidth)||0),this},s.start=function(t){if(E=this.optns.number,!t)return this.frame();if(this.interval)return this;this.isAnimated=t,this.recalculateOffset();var e=W[this.optns.number],i=e.optns;return this.cnv.onclick=function(t){u(t,"click",i)},this.cnv.ondblclick=function(t){u(t,"dblclick",i);var e=i.mousemove.val;i.mousemove.val=!0,setTimeout(function(){i.mousemove.val=e},3e3)},this.cnv.onmousedown=function(t){u(t,"mousedown",i)},this.cnv.onmouseup=function(t){u(t,"mouseup",i)},this.cnv.onkeyup=function(t){c(t,"keyUp",i)},this.cnv.onkeydown=function(t){c(t,"keyDown",i)},this.cnv.onkeypress=function(t){c(t,"keyPress",i)},this.cnv.onmouseout=this.cnv.onmousemove=function(t){u(t,"mousemove",i)},i.timeLast=new Date,this.interval=ot(function(t){e.interval=e.interval||1,e.frame(t)},this.cnv),this},s.pause=function(){return at(this.interval),this.interval=0,this},s.restart=function(){return this.pause().start(!0)},s.del=function(){at(this.interval),this.layers=[],W.splice(this.optns.number,1);for(var t=0;t<W.length;t++){var e=W[t],i=e.layers,n=i.length;e.optns.number=t;for(var s=0;n>s;s++){var r=i[s];r.optns.canvas.number=t,O(r.objs,r.optns.id,r.optns.number,e.optns.id,e.optns.number),O(r.grdntsnptrns,r.optns.id,r.optns.number,e.optns.id,e.optns.number)}}return this.cnv.parentNode&&this.cnv.parentNode.removeChild(this.cnv),E=0,!1},s.clear=function(){return at(this.interval),this.interval=0,this.layers=[],lt.layer(this.optns.id+"Layer_0").canvas(this.optns.id),this.optns.ctx.clearRect(0,0,this.optns.width,this.optns.height),this.optns.redraw++,this},s.frame=function(n){var s=this.optns,r=this;if(n=n||new Date,s.timeDiff=n-s.timeLast,s.timeLast=n,this.interval&&(this.interval=ot(function(t){r.frame(t)},r.cnv),this.interval=this.interval||1),!s.redraw)return this;if(s.redraw--,s.ctx.clearRect(0,0,s.width,s.height),0==this.layers.length)return this;if(i=this.layers.length,s.anyLayerLevelChanged&&(i=A(this.layers)),s.anyLayerDeleted&&(i=D(this.layers)),s.anyLayerLevelChanged||s.anyLayerDeleted){s.anyLayerLevelChanged=s.anyLayerDeleted=!1;for(var o=0;i>o;o++){var a=this.layers[o],h=a.optns;O(a.objs,h.id,h.number,this.optns.id,this.optns.number),O(a.grdntsnptrns,h.id,h.number,t,this.optns.number)}}for(o=0;i>o;o++){var l=this.layers[o];"function"==typeof l.draw&&l.beforeDraw(s)&&"function"==typeof l.draw&&(l.draw(s),l.afterDraw(s))}var c=s.mousemove,u=s.mousedown,f=s.mouseup,p=this.optns.click,m=this.optns.dblclick;if(0!=c.x){if(0!=s.drag.object){var d=s.drag,y=d.object;y.translate(c.x-d.x,c.y-d.y),d.x=c.x,d.y=c.y,d.drag&&d.drag.call(y,{x:c.x,y:c.y})}var g=this.optns.point||{};if(g.event=c.event,0!=c.object){var _=c.object,b=I(_);F===_?("function"==typeof _.onmousemove&&_.onmousemove(g),b===q?"function"==typeof b.onmousemove&&b.onmousemove(g):(q&&"function"==typeof q.onmouseout&&q.onmouseout(g),"function"==typeof b.onmouseover&&b.onmouseover(g),q=b)):(F&&"function"==typeof F.onmouseout&&F.onmouseout(g),"function"==typeof _.onmouseover&&_.onmouseover(g),F=_)}else F&&("function"==typeof F.onmouseout&&F.onmouseout(g),F=!1),q&&("function"==typeof q.onmouseout&&q.onmouseout(g),q=!1);s.mousemove.object=!1}if(u.objects.length){var x=u.objects.length-1;t:for(o=x;o>-1;o--)for(var w,j=[u.objects[o],I(u.objects[o])],C=0;2>C;C++){if(w=j[C],1==w.optns.drag.val&&0==w.optns.drag.disabled&&o==x){d=s.drag,y=d.object=w.optns.drag.object.visible(!0),d.drag=w.optns.drag.drag,d.init=w;var P=d.init.optns;P.drag.params!==e&&y.animate(P.drag.params),d.x=d.startX=u.x,d.y=d.startY=u.y,y!=d.init&&"clone"!=P.drag.type&&(g=v(u.x,u.y,y.matrix()),y.translate(g.x-y._x,g.y-y._y)),y.translate(P.drag.shiftX,P.drag.shiftY),"function"==typeof P.drag.start&&P.drag.start.call(y,{x:u.x,y:u.y})}if("function"==typeof w.onmousedown&&w.onmousedown({x:u.x,y:u.y,event:u.event})===!1)break t}u.objects=[]}if(f.objects.length){t:for(o=f.objects.length-1;o>-1;o--){var k,T=[f.objects[o],I(f.objects[o])];for(C=0;2>C;C++)if(k=T[C],L(k,f,s)&&(p.objects=[]),"function"==typeof k.onmouseup&&k.onmouseup({x:f.x,y:f.y,event:f.event})===!1)break t}this.optns.drag={object:!1,x:0,y:0},f.objects=[]}if(p.objects.length){t:for(o=p.objects.length-1;o>-1;o--){var M,Y=[p.objects[o],I(p.objects[o])];for(C=0;2>C;C++)if(M=Y[C],L(M,p,s),"function"==typeof M.onclick&&M.onclick({x:p.x,y:p.y,event:p.event})===!1)break t}this.optns.drag={object:!1,x:0,y:0},p.objects=[]}if(m.objects.length){t:for(o=m.objects.length-1;o>-1;o--){var X=[m.objects[o],I(m.objects[o])];for(C=0;2>C;C++)if("function"==typeof X[C].ondblclick&&X[C].ondblclick({x:m.x,y:m.y,event:m.event})===!1)break t}m.objects=[]}return s.keyUp.val=s.keyDown.val=s.keyPress.val=p.x=m.x=f.x=u.x=c.x=!1,this},s},lt.layer=function(t){if(t===e)return W[0].layers[0];for(var i=0;i<W.length;i++)for(var n=W[i].layers,s=0;s<n.length;s++)if(n[s].optns.id==t)return n[s];return B(t)},t.jCanvaScript=t.jc=lt}(window,void 0),String.prototype.findNum=function(){return this.match(/\d+/g)};var Tween={linear:function(t,e,i,n){return i*t/n+e},easeIn:function(t,e,i,n){return i*(t/=n)*t+e},easeOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeBoth:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e;
},easeInStrong:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutStrong:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeBothStrong:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},elasticIn:function(t,e,i,n,s,r){if(0===t)return e;if(1==(t/=n))return e+i;if(r||(r=.3*n),!s||s<Math.abs(i)){s=i;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(i/s);return-(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/r))+e},elasticOut:function(t,e,i,n,s,r){if(0===t)return e;if(1==(t/=n))return e+i;if(r||(r=.3*n),!s||s<Math.abs(i)){s=i;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(i/s);return s*Math.pow(2,-10*t)*Math.sin((t*n-o)*(2*Math.PI)/r)+i+e},elasticBoth:function(t,e,i,n,s,r){if(0===t)return e;if(2==(t/=n/2))return e+i;if(r||(r=n*(.3*1.5)),!s||s<Math.abs(i)){s=i;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(i/s);return 1>t?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/r))+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/r)*.5+i+e},backIn:function(t,e,i,n,s){return"undefined"==typeof s&&(s=1.70158),i*(t/=n)*t*((s+1)*t-s)+e},backOut:function(t,e,i,n,s){return"undefined"==typeof s&&(s=3.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},backBoth:function(t,e,i,n,s){return"undefined"==typeof s&&(s=1.70158),(t/=n/2)<1?i/2*(t*t*(((s*=1.525)+1)*t-s))+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},bounceIn:function(t,e,i,n){return i-Tween.bounceOut(n-t,0,i,n)+e},bounceOut:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceBoth:function(t,e,i,n){return n/2>t?.5*Tween.bounceIn(2*t,0,i,n)+e:.5*Tween.bounceOut(2*t-n,0,i,n)+.5*i+e}};game.prototype.runing=function(){var t=this;t.run=setInterval(function(){for(a in t.monomer)t.monomer[a]&&t.monomer[a].timeC&&t.monomer[a].run()},t.speed)},game.prototype["int"]=function(){var t=this;t.score=0,t.w=view().w-50,t.h=view().h-50,t.monomer={},t.position={},t.num=0,clearTimeout(t.timeC),clearInterval(t.countdown),s("score").innerHTML="X"+Number(t.num),jc.clear(),t.next()},game.prototype.bindEvent=function(){var t=this;document.ontouchstart=function(e){function i(){var t=document.createElement("div");t.className="bg",t.id="bg",document.body.appendChild(t),addClass(document.body,"shake"),stopPP(t),setTimeout(function(){removeClass(document.body,"shake"),remove(t)},1e3)}e.preventDefault();var n=e.changedTouches[0],s=n.pageY,r=n.pageX;for(a in t.position)if(r>=t.position[a][0]-50&&r<=t.position[a][0]+150&&s>=t.position[a][1]-50&&s<=t.position[a][1]+150)return t.monomer[a].Stop({a:a,next:!0}),gameHit(),!1;i(),lolCareful()}},game.prototype.begin=function(){var t=this,e=document.createElement("div");e.className="alert",e.innerHTML="<em>	-<b>游戏规则</b>-<br/>	当小鬼子窜出来时，拿起你的手指，瞄准后按死“小鬼子”们！一定要按准哦……<br/>	</em><button>开始打鬼子</button>",e.id="begin",document.body.appendChild(e),e.getElementsByTagName("button")[0].ontouchstart=function(i){var i=i||event;i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,t.next(),lolStart(),remove(e),t.bindEvent()}},document.ontouchstart=function(t){t.preventDefault()};